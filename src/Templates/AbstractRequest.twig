<?php
namespace {{ namespace }}\Message\Request;

use {{ namespace }}\Exception\ValidationException;
use {{ namespace }}\Message\Response\ResponseInterface;

abstract class AbstractRequest implements RequestInterface
{
    /**
     * @var string
     */
    protected $method;
    /**
     * @var string
     */
    protected $api_version = 1;
    protected $endpoint;

    protected function getData() : array {
       try {
        $this->validate();
        $data = $this->getParameters();
       } catch (\Exception $e) {throw $e;}

       return $data;
    }

    public function send() : ResponseInterface {
        return $this->sendData($this->getData());
    }

    abstract protected function validate();

    abstract protected function sendData($data) :?ResponseInterface;

    protected function setEndpoint($value) {
        $this->endpoint = $value;
    }

    abstract protected function sendRequest($method, $endpoint, array $headers = [], array $data = [] );

    abstract protected function setParameter(string $key, $value);
    abstract protected function createResponse(array $data) : ResponseInterface;

    abstract public function setApiVersion($value);

    abstract public function getApiVersion() : int;

    abstract public function getEndpointUrl(?array $params = []): string; 

    abstract public function getTestMode(): boolean;

    abstract public function setTestMode( $value = true);

    abstract public function getParameters();
 }